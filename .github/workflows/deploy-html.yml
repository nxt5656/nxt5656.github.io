name: Build and Deploy HTML

on:
  push:
    branches:
      - main # 监听 `main` 分支的推送事件（可根据实际分支调整）
permissions:
  contents: write
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # Step 1: 检出代码
      - name: 检出代码
        uses: actions/checkout@v3
      # Step 2: 使用 Docker 生成新的文件
      - name: 使用 Docker 生成新的文件
        run: |
          docker run --rm \
            -v ${{ github.workspace }}/notes:/srv/gitbook \
            fellah/gitbook:latest \
            gitbook build
      # Step 3: 配置生成的文件并推送到目标分支
      - name: 配置生成的文件并推送到目标分支
        run: |
          # 设置用户信息
          git config user.name "${{ github.actor }}"
          git config user.email "nxt5656@live.cn"
          # 初始化新的分支
          git switch --orphan web-html
          git reset --hard

          # 将生成的文件添加到分支
          cp -R ${{ github.workspace }}/notes/_book .
          git add .

          # 提交更改
          git commit -m "Deploy generated files to web-html branch"

          # 强制推送到目标分支
          git push origin web-html --force